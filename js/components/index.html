<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>USEITI Data: Components</title>
    <!--[if lte IE 9]>
    <script src="../vendor/aight.min.js"></script>
    <![endif]-->
    <script src="../vendor/document-register-element.js"></script>
    <script src="../vendor/d3.v3.min.js"></script>
    <script src="custom-element.js"></script>
    <script src="region-map.js"></script>
    <!-- region-map dependencies -->
    <script src="../../lib/albers-custom.js"></script>
    <script src="../vendor/topojson.v1.min.js"></script>
    <script src="../vendor/queue.v1.min.js"></script>
    <script src="../progressive.js"></script>
    <!-- /region-map -->
    <script src="x-slider.js"></script>
    <link rel="stylesheet" href="../../css/index.css">
    <link rel="stylesheet" href="../../css/components.css">
    <style>

      section {
        margin-bottom: 4em;
      }

      .container {
        max-width: 40em;
      }

      x-slider {
        margin: 3em 1.5em;
      }

      label {
        font-weight: bold;
      }

      input[type="number"] {
        font-size: inherit;
        width: 6em;
      }

      dt {
        font-size: 1.5em;
        font-weight: bold;
      }

      dd {
        padding-left: 0;
        margin: .5em 0 .5em 1em;
      }

      kbd {
        font-family: monospace;
        background: #f9f9f9;
        padding: .1em .3em;
        border: 1px solid #ccc;
        border-radius: .3em;
        box-shadow: 1px 1px 1px rgba(0, 0, 0, .1);
      }

      custom-element {
        display: inline-block;
        background: #ffc;
        border: 1px solid #ddd;
        padding: .5em;
        border-radius: .5em;
        cursor: pointer;
      }

    </style>
  </head>
  <body unresolved>
    <header class="container">
      <h1>Components!</h1>
    </header>

    <section id="custom-element" class="container">
      <h2><tt>&lt;custom-element&gt;</tt></h2>
      <p>This is really just a test of the custom element template. Click on it
        and its text should change to a random number.</p>
      <custom-element>123</custom-element>
      <script>
      (function() {
        d3.select('custom-element')
          .on('change', function() {
            this.textContent = ~~(this.value * 1000);
          });
      })();
      </script>
    </section>

    <section id="region-map" class="container">
      <h2><tt>&lt;region-map&gt;</tt></h2>
      <p>The <tt>&lt;region-map&gt;</tt> element renders a region map with both
        onshore and offshore areas. Coloring them is done in a
        <tt>load</tt> event listener with D3.</p>
      <dl>
        <dt><tt>data-path=""</tt></dt>
        <dd>String: the path to the state and offshore area TopoJSON
          files (<tt>output/geo/us-states.json</tt> and
          <tt>output/geo/offshore.json</tt>, respectively).</dd>
      </dl>

      <region-map data-path="../../">
        <svg>
        </svg>
      </region-map>
      <script>
      (function() {
        d3.select('region-map')
          .on('load', function() {
            console.log('region map loaded');
            var region = d3.select(this).selectAll('g.region');
            var regions = region.data();
            var extent = d3.extent(regions, length);
            var color = d3.scale.linear()
              .domain(extent)
              .range(['#eee', 'blue']);
            region.attr('fill', function(d) {
              return color(length(d));
            });
            function length(d) {
              return (d.properties.name || d.id || '').length;
            }
          });
      })();
      </script>
    </section>

    <section id="slider" class="container">
      <h2><tt>&lt;x-slider&gt;</tt></h2>
      <p>The <tt>&lt;x-slider&gt;</tt> element provides a horizontal slider
        control with the following attributes and corresponding properties:</p>
      <dl>
        <dt><tt>value="0"</tt></dt>
        <dd>Number: the value</dd>
        <dt><tt>min="0"</tt></dt>
        <dd>Number: the minimum value</dd>
        <dt><tt>max="100"</tt></dt>
        <dd>Number: the maximum value</dd>
        <dt><tt>snap</tt></dt>
        <dd>Boolean: whether to snap to round values</dd>
      </dl>

      <p>This text should indicate the value when changed:</p>
      <p><b class="year"></b></p>

      <form onsubmit="return false;">
        <p>And this input should both reflect the current value and modify
          the slider when changed. It should not be possible to set values
          outside of the slider's min and max.</p>
        <p><input id="year-input" type="number" step="1" size="4"></p>
      </form>

      <x-slider snap min="2004" max="2013" value="2008">
        <div tabindex="0" class="handle">
          <span class="value"></span>
        </div>
      </x-slider>

      <p>Click anywhere on the slider to change its value, or click and drag
        to change it as the mouse (or touch cursor)
        moves. You should also be able to focus the
        slider handle with the <kbd>tab</kbd> key and using
        the left and right arrows to move the slider.</p>

      <script>
      (function() {

        var context = d3.select('#slider');

        var slider = context.select('x-slider')
          .on('change', function() {
            // console.log('slider change', this.value);
            year.text(this.value);
            input.property('value', this.value);
          });

        var year = context.selectAll('.year')
          .text(slider.property('value'));

        var input = context.select('input')
          .property('value', slider.property('value'))
          .on('change', function() {
            slider.property('value', this.value);
          });

      })();
      </script>
    </section>

  </body>
</html>
