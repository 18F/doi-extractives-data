{% assign revenue_year = '2014' %}
{% assign streams = site.data.opt_in_state_revenues[include.location_id].streams %}

{% if streams.size > 0 %}
  {% assign streams_info = site.data.opt_in_state_streams[include.location_id] %}
  {% assign streams_count = streams.size | minus: 1 %}
  {% assign revenue_total = streams.All.Total[revenue_year] %}

{% if page.state_disbursements %}
  {{ page.state_disbursements | markdownify }}
{% endif %}

<p><strong>
  In {{ year }}, ${{ revenue_total | default: 0 | intcomma }}
  in state revenue from natural resource extraction in 
  {{ state_name }} was disbursed
  from {{ streams_count }} revenue stream{{ streams_count | plural }}.
</strong></p>

<table is="bar-chart-table" class="table-basic"
  {% if include.id %}id="{{ include.id }}"{% endif %}>
  <thead>
    <tr>
      <th>Revenue stream</th>
      <th class="num">Amount collected</th>
    </tr>
  </thead>

  {% for _stream in streams %}
    {% assign stream = _stream[0] %}
    {% assign stream_name = stream | xml_escape %}
    {% if stream_name == 'All' %}
      {% assign stream_name = 'Total' %}
    {% endif %}
    {% assign stream_slug = stream | slugify %}
    {% assign stream_sources = _stream[1] %}
    {% assign stream_info = streams_info[stream] %}
    {% assign stream_dollars = stream_sources.Total[revenue_year] %}
  <tbody id="revenue-disbursement-stream-{{ stream_slug }}"
    class="table-accordion-group">
    <tr>
      <td>
        {% if stream_info %}
        <button is="aria-toggle" aria-controls="stream-{{ stream_slug }}"
          aria-expanded="false" class="not-button-like">
          <strong>{{ stream_name }}</strong>
        </button>
        {% else %}
        <strong>{{ stream_name }}</strong>
        {% endif %}
      </td>
      <td data-value="{{ stream_dollars }}"
        data-year-values='{{ stream_sources.Total | jsonify }}'>
        ${{ stream_dollars | default: 0 | intcomma }}
      </td>
    </tr>
    {% if stream_info %}
    <tr id="stream-{{ stream_slug }}">
      <td colspan="2">{{ stream_info }}</td>
    </tr>
    {% endif %}
  </tbody>
  {% endfor %}
</table>
{% endif %}

